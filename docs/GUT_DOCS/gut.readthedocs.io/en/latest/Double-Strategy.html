<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Doubling Strategy &mdash; GUT 9.4.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/gut_custom.css" type="text/css" />
      <link rel="stylesheet" href="_static/dark_mode_css/general.css" type="text/css" />
      <link rel="stylesheet" href="_static/dark_mode_css/dark.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js%3Fv=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js%3Fv=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js%3Fv=354d2d61"></script>
        <script src="_static/doctools.js%3Fv=888ff710"></script>
        <script src="_static/sphinx_highlight.js%3Fv=4825356b"></script>
        <script src="_static/dark_mode_js/default_dark.js%3Fv=fd565c74"></script>
        <script src="_static/dark_mode_js/theme_switcher.js%3Fv=358d3910"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Stubbing" href="Stubbing.html" />
    <link rel="prev" title="Partial Doubles" href="Partial-Doubles.html" /> 
<script async type="text/javascript" src="../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="gut" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/Double-Strategy.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            GUT
              <img src="_static/GutDocsLogo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                9.4.0 for Godot-4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="Quick-Start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="Command-Line.html">Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="New-For-Godot-4.html">Godot 4 Changes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Test Scripts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="class_ref/class_guttest.html">GutTest</a></li>
<li class="toctree-l1"><a class="reference internal" href="Creating-Tests.html">Creating Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="Awaiting.html">Awaiting</a></li>
<li class="toctree-l1"><a class="reference internal" href="Inner-Test-Classes.html">Inner Test Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Parameterized-Tests.html">Parameterized Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="Simulate.html">Simulate</a></li>
<li class="toctree-l1"><a class="reference internal" href="Comparing-Things.html">Comparing Things</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Doubling</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Doubles.html">Doubles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Partial-Doubles.html">Partial Doubles</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="Double-Strategy.html#">Doubling Strategy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Double-Strategy.html#set-the-default-strategy">Set the Default Strategy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Double-Strategy.html#gutconfig">.gutconfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="Double-Strategy.html#command-line">Command Line</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Double-Strategy.html#overriding-the-default">Overriding the Default</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Double-Strategy.html#script-level">Script Level</a></li>
<li class="toctree-l3"><a class="reference internal" href="Double-Strategy.html#individual-double-partial-double">Individual Double/Partial Double</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Stubbing.html">Stubbing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Spies.html">Spies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="GDScript-Warnings.html">GDScript Warnings</a></li>
<li class="toctree-l1"><a class="reference internal" href="Export-Test-Results.html">Export Test Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hooks.html">Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Memory-Management.html">Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mocking-Input.html">Mocking Input</a></li>
<li class="toctree-l1"><a class="reference internal" href="Orphans.html">Orphans</a></li>
<li class="toctree-l1"><a class="reference internal" href="Running-On-Devices.html">Running on Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Class Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Class-Ref.html">About Class Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_ref/class_addons_gut_cli_optparse.html">addons/gut/cli/optparse.gd</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_ref/class_addons_gut_junit_xml_export.html">addons/gut/junit_xml_export.gd</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_ref/class_addons_gut_parameter_factory.html">addons/gut/parameter_factory.gd</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_ref/class_guthookscript.html">GutHookScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_ref/class_gutinputfactory.html">GutInputFactory</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_ref/class_gutinputsender.html">GutInputSender</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_ref/class_gutmain.html">GutMain</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_ref/class_guttest.html">GutTest</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GUT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Doubling Strategy</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Double-Strategy.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="doubling-strategy">
<h1>Doubling Strategy<a class="headerlink" href="Double-Strategy.html#doubling-strategy" title="Permalink to this heading"></a></h1>
<p>By default Godot 4 does not allow you to override native methods defined in Godot Objects (you can change this in the project settings: Debug-&gt;GDScript-&gt;Native Method Override).  For example, overriding <code class="docutils literal notranslate"><span class="pre">set_position</span></code> on a Node2D will cause an error.  This is because the engine may or may not use overrides in some cases for performance reasons.  It has something to do with pointers and functions and efficiency and stuff.  I don’t fully understand it, but it’s true (<a class="reference external" href="https://github.com/godotengine/godot/issues/55024">Here’s a Github Issue with some info</a>).  The important thing for us, is that this means you cannot spy-on or stub these functions…or can you?</p>
<hr>
<p><strong>Warning:</strong>  <code class="docutils literal notranslate"><span class="pre">INCLUDE_NATIVE</span></code> is not compatible with static typing.  When you statically type a variable, Godot will call all of its native methods directly, bypassing the overrides in the double.  See <a class="reference external" href="https://github.com/bitwes/Gut/issues/633#issuecomment-2198440346">this issue</a> for more information and some examples.</p>
<hr>
<p>In most cases Doubles are not used in a manner that would cause the engine to directly interact with them.  You may want to verify that some object you created calls <code class="docutils literal notranslate"><span class="pre">set_position</span></code> on a double.  This is where changing the Double Strategy can help.  When using <code class="docutils literal notranslate"><span class="pre">DOUBLE_STRATEGY.INCLUDE_NATIVE</span></code> GUT will override all native functions which means you can spy-on and stub them for your tests.  It will also disable the error and then restore the original setting after the Double or Partial Double is created so that GUT does not blow up.  Only direct calls that you make in your objects are guaranteed use the overrides.  A tween probably won’t call your <code class="docutils literal notranslate"><span class="pre">set_position</span></code> override.</p>
<p>The default Double Strategy is <code class="docutils literal notranslate"><span class="pre">SCRIPT_ONLY</span></code>, meaning no overrides will be included.  You can change the strategy globally, at the script level, or for an individual Double or Partial Double.</p>
<section id="set-the-default-strategy">
<h2>Set the Default Strategy<a class="headerlink" href="Double-Strategy.html#set-the-default-strategy" title="Permalink to this heading"></a></h2>
<p>You can change the default through the GutPanel in the editor, the <code class="docutils literal notranslate"><span class="pre">.gutconfig.json</span></code> file for the command line, or as a command line option.  Note that the editor and the command line configuration are separate, so you must set it in both places if you are using both.</p>
<section id="gutconfig">
<h3>.gutconfig<a class="headerlink" href="Double-Strategy.html#gutconfig" title="Permalink to this heading"></a></h3>
<p>Valid values are <code class="docutils literal notranslate"><span class="pre">SCRIPT_ONLY</span></code>(default) or <code class="docutils literal notranslate"><span class="pre">INCLUDE_NATIVE</span></code></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;double_strategy&quot;</span><span class="p">:</span><span class="s2">&quot;INCLUDE_NATIVE&quot;</span>
</pre></div>
</div>
</section>
<section id="command-line">
<h3>Command Line<a class="headerlink" href="Double-Strategy.html#command-line" title="Permalink to this heading"></a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">-gdouble_strategy</span></code> option with the values <code class="docutils literal notranslate"><span class="pre">INCLUDE_NATIVE</span></code> or <code class="docutils literal notranslate"><span class="pre">SCRIPT_ONLY</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-gdouble_strategy<span class="o">=</span><span class="s1">&#39;SCRIPT_ONLY&#39;</span>
</pre></div>
</div>
</section>
</section>
<section id="overriding-the-default">
<h2>Overriding the Default<a class="headerlink" href="Double-Strategy.html#overriding-the-default" title="Permalink to this heading"></a></h2>
<section id="script-level">
<h3>Script Level<a class="headerlink" href="Double-Strategy.html#script-level" title="Permalink to this heading"></a></h3>
<p>From within a <code class="docutils literal notranslate"><span class="pre">GutTest</span></code> script you can call <code class="docutils literal notranslate"><span class="pre">set_double_strategy</span></code> to change the strategy for that script/inner-class ONLY.  This value will be reset to the default after the script has finished.  You should call this in <code class="docutils literal notranslate"><span class="pre">before_all</span></code>.</p>
<div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="n">set_double_strategy</span><span class="p">(</span><span class="n">DOUBLE_STRATEGY</span><span class="o">.</span><span class="n">INCLUDE_NATIVE</span><span class="p">)</span>
<span class="n">set_double_strategy</span><span class="p">(</span><span class="n">DOUBLE_STRATEGY</span><span class="o">.</span><span class="n">SCRIPT_ONLY</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="individual-double-partial-double">
<h3>Individual Double/Partial Double<a class="headerlink" href="Double-Strategy.html#individual-double-partial-double" title="Permalink to this heading"></a></h3>
<p>When calling <code class="docutils literal notranslate"><span class="pre">double</span></code> or <code class="docutils literal notranslate"><span class="pre">partial_double</span></code> you can pass an optional parameter to set the double strategy for just that double.</p>
<div class="highlight-gdscript notranslate"><div class="highlight"><pre><span></span><span class="n">double</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span><span class="w"> </span><span class="n">DOUBLE_STRATEGY</span><span class="o">.</span><span class="n">SCRIPT_ONLY</span><span class="p">)</span>
<span class="n">partial_double</span><span class="p">(</span><span class="n">Bar</span><span class="p">,</span><span class="w"> </span><span class="n">DOUBLE_STRATEGY</span><span class="o">.</span><span class="n">INCLUDE_NATIVE</span><span class="p">)</span>
<span class="n">double</span><span class="p">(</span><span class="n">MyScene</span><span class="p">,</span><span class="w"> </span><span class="n">DOUBLE_STRATEGY</span><span class="o">.</span><span class="n">SCRIPT_ONLY</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Partial-Doubles.html" class="btn btn-neutral float-left" title="Partial Doubles" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Stubbing.html" class="btn btn-neutral float-right" title="Stubbing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Butch Wesley.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>